/*!
 * jQuery UI Sortable @VERSION
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./mouse","../data","../ie","../scroll-parent","../version","../widget"],a)}else{a(jQuery)}}(function(a){return a.widget("ui.sortable",a.ui.mouse,{version:"@VERSION",widgetEventPrefix:"sort",ready:false,options:{appendTo:"parent",axis:false,connectWith:false,containment:false,cursor:"auto",cursorAt:false,dropOnEmpty:true,forcePlaceholderSize:false,forceHelperSize:false,grid:false,handle:false,helper:"original",items:"> *",opacity:false,placeholder:false,revert:false,scroll:true,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1000,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(c,b,d){return(c>=b)&&(c<(b+d))},_isFloating:function(b){return(/left|right/).test(b.css("float"))||(/inline|table-cell/).test(b.css("display"))},_create:function(){this.containerCache={};this._addClass("ui-sortable");this.refresh();this.offset=this.element.offset();this._mouseInit();this._setHandleClassName();this.ready=true},_setOption:function(b,c){this._super(b,c);if(b==="handle"){this._setHandleClassName()}},_setHandleClassName:function(){var b=this;this._removeClass(this.element.find(".ui-sortable-handle"),"ui-sortable-handle");a.each(this.items,function(){b._addClass(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item,"ui-sortable-handle")})},_destroy:function(){this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--){this.items[b].item.removeData(this.widgetName+"-item")}return this},_mouseCapture:function(d,e){var b=null,f=false,c=this;if(this.reverting){return false}if(this.options.disabled||this.options.type==="static"){return false}this._refreshItems(d);a(d.target).parents().each(function(){if(a.data(this,c.widgetName+"-item")===c){b=a(this);return false}});if(a.data(d.target,c.widgetName+"-item")===c){b=a(d.target)}if(!b){return false}if(this.options.handle&&!e){a(this.options.handle,b).find("*").addBack().each(function(){if(this===d.target){f=true}});if(!f){return false}}this.currentItem=b;this._removeCurrentsFromItems();return true},_mouseStart:function(e,f,c){var d,b,g=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(e);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(e);this.originalPageX=e.pageX;this.originalPageY=e.pageY;(g.cursorAt&&this._adjustOffsetFromHelper(g.cursorAt));this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};if(this.helper[0]!==this.currentItem[0]){this.currentItem.hide()}this._createPlaceholder();if(g.containment){this._setContainment()}if(g.cursor&&g.cursor!=="auto"){b=this.document.find("body");this.storedCursor=b.css("cursor");b.css("cursor",g.cursor);this.storedStylesheet=a("<style>*{ cursor: "+g.cursor+" !important; }</style>").appendTo(b)}if(g.opacity){if(this.helper.css("opacity")){this._storedOpacity=this.helper.css("opacity")}this.helper.css("opacity",g.opacity)}if(g.zIndex){if(this.helper.css("zIndex")){this._storedZIndex=this.helper.css("zIndex")}this.helper.css("zIndex",g.zIndex)}if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){this.overflowOffset=this.scrollParent.offset()}this._trigger("start",e,this._uiHash());if(!this._preserveHelperProportions){this._cacheHelperProportions()}if(!c){for(d=this.containers.length-1;d>=0;d--){this.containers[d]._trigger("activate",e,this._uiHash(this))}}if(a.ui.ddmanager){a.ui.ddmanager.current=this}if(a.ui.ddmanager&&!g.dropBehaviour){a.ui.ddmanager.prepareOffsets(this,e)}this.dragging=true;this._addClass(this.helper,"ui-sortable-helper");this._mouseDrag(e);return true},_mouseDrag:function(f){var d,e,c,h,g=this.options,b=false;this.position=this._generatePosition(f);this.positionAbs=this._convertPositionTo("absolute");if(!this.lastPositionAbs){this.lastPositionAbs=this.positionAbs}if(this.options.scroll){if(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0].tagName!=="HTML"){if((this.overflowOffset.top+this.scrollParent[0].offsetHeight)-f.pageY<g.scrollSensitivity){this.scrollParent[0].scrollTop=b=this.scrollParent[0].scrollTop+g.scrollSpeed}else{if(f.pageY-this.overflowOffset.top<g.scrollSensitivity){this.scrollParent[0].scrollTop=b=this.scrollParent[0].scrollTop-g.scrollSpeed}}if((this.overflowOffset.left+this.scrollParent[0].offsetWidth)-f.pageX<g.scrollSensitivity){this.scrollParent[0].scrollLeft=b=this.scrollParent[0].scrollLeft+g.scrollSpeed}else{if(f.pageX-this.overflowOffset.left<g.scrollSensitivity){this.scrollParent[0].scrollLeft=b=this.scrollParent[0].scrollLeft-g.scrollSpeed}}}else{if(f.pageY-this.document.scrollTop()<g.scrollSensitivity){b=this.document.scrollTop(this.document.scrollTop()-g.scrollSpeed)}else{if(this.window.height()-(f.pageY-this.document.scrollTop())<g.scrollSensitivity){b=this.document.scrollTop(this.document.scrollTop()+g.scrollSpeed)}}if(f.pageX-this.document.scrollLeft()<g.scrollSensitivity){b=this.document.scrollLeft(this.document.scrollLeft()-g.scrollSpeed)}else{if(this.window.width()-(f.pageX-this.document.scrollLeft())<g.scrollSensitivity){b=this.document.scrollLeft(this.document.scrollLeft()+g.scrollSpeed)}}}if(b!==false&&a.ui.ddmanager&&!g.dropBehaviour){a.ui.ddmanager.prepareOffsets(this,f)}}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!=="y"){this.helper[0].style.left=this.position.left+"px"}if(!this.options.axis||this.options.axis!=="x"){this.helper[0].style.top=this.position.top+"px"}for(d=this.items.length-1;d>=0;d--){e=this.items[d];c=e.item[0];h=this._intersectsWithPointer(e);if(!h){continue}if(e.instance!==this.currentContainer){continue}if(c!==this.currentItem[0]&&this.placeholder[h===1?"next":"prev"]()[0]!==c&&!a.contains(this.placeholder[0],c)&&(this.options.type==="semi-dynamic"?!a.contains(this.element[0],c):true)){this.direction=h===1?"down":"up";if(this.options.tolerance==="pointer"||this._intersectsWithSides(e)){this._rearrange(f,e)}else{break}this._trigger("change",f,this._uiHash());break}}this._contactContainers(f);if(a.ui.ddmanager){a.ui.ddmanager.drag(this,f)}this._trigger("sort",f,this._uiHash());this.lastPositionAbs=this.positionAbs;return false},_mouseStop:function(d,f){if(!d){return}if(a.ui.ddmanager&&!this.options.dropBehaviour){a.ui.ddmanager.drop(this,d)}if(this.options.revert){var c=this,g=this.placeholder.offset(),b=this.options.axis,e={};if(!b||b==="x"){e.left=g.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)}if(!b||b==="y"){e.top=g.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)}this.reverting=true;a(this.helper).animate(e,parseInt(this.options.revert,10)||500,function(){c._clear(d)})}else{this._clear(d,f)}return false},cancel:function(){if(this.dragging){this._mouseUp(new a.Event("mouseup",{target:null}));if(this.options.helper==="original"){this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}for(var b=this.containers.length-1;b>=0;b--){this.containers[b]._trigger("deactivate",null,this._uiHash(this));if(this.containers[b].containerCache.over){this.containers[b]._trigger("out",null,this._uiHash(this));this.containers[b].containerCache.over=0}}}if(this.placeholder){if(this.placeholder[0].parentNode){this.placeholder[0].parentNode.removeChild(this.placeholder[0])}if(this.options.helper!=="original"&&this.helper&&this.helper[0].parentNode){this.helper.remove()}a.extend(this,{helper:null,dragging:false,reverting:false,_noFinalSort:null});if(this.domPosition.prev){a(this.domPosition.prev).after(this.currentItem)}else{a(this.domPosition.parent).prepend(this.currentItem)}}return this},serialize:function(d){var b=this._getItemsAsjQuery(d&&d.connected),c=[];d=d||{};a(b).each(function(){var e=(a(d.item||this).attr(d.attribute||"id")||"").match(d.expression||(/(.+)[\-=_](.+)/));if(e){c.push((d.key||e[1]+"[]")+"="+(d.key&&d.expression?e[1]:e[2]))}});if(!c.length&&d.key){c.push(d.key+"=")}return c.join("&")},toArray:function(d){var b=this._getItemsAsjQuery(d&&d.connected),c=[];d=d||{};b.each(function(){c.push(a(d.item||this).attr(d.attribute||"id")||"")});return c},_intersectsWith:function(o){var e=this.positionAbs.left,d=e+this.helperProportions.width,m=this.positionAbs.top,k=m+this.helperProportions.height,f=o.left,c=f+o.width,p=o.top,j=p+o.height,q=this.offset.click.top,i=this.offset.click.left,h=(this.options.axis==="x")||((m+q)>p&&(m+q)<j),n=(this.options.axis==="y")||((e+i)>f&&(e+i)<c),g=h&&n;if(this.options.tolerance==="pointer"||this.options.forcePointerForContainers||(this.options.tolerance!=="pointer"&&this.helperProportions[this.floating?"width":"height"]>o[this.floating?"width":"height"])){return g}else{return(f<e+(this.helperProportions.width/2)&&d-(this.helperProportions.width/2)<c&&p<m+(this.helperProportions.height/2)&&k-(this.helperProportions.height/2)<j)}},_intersectsWithPointer:function(d){var c,g,e=(this.options.axis==="x")||this._isOverAxis(this.positionAbs.top+this.offset.click.top,d.top,d.height),b=(this.options.axis==="y")||this._isOverAxis(this.positionAbs.left+this.offset.click.left,d.left,d.width),f=e&&b;if(!f){return false}c=this._getDragVerticalDirection();g=this._getDragHorizontalDirection();return this.floating?((g==="right"||c==="down")?2:1):(c&&(c==="down"?2:1))},_intersectsWithSides:function(e){var c=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+(e.height/2),e.height),d=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+(e.width/2),e.width),b=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();if(this.floating&&f){return((f==="right"&&d)||(f==="left"&&!d))}else{return b&&((b==="down"&&c)||(b==="up"&&!c))}},_getDragVerticalDirection:function(){var b=this.positionAbs.top-this.lastPositionAbs.top;return b!==0&&(b>0?"down":"up")},_getDragHorizontalDirection:function(){var b=this.positionAbs.left-this.lastPositionAbs.left;return b!==0&&(b>0?"right":"left")},refresh:function(b){this._refreshItems(b);this._setHandleClassName();this.refreshPositions();return this},_connectWith:function(){var b=this.options;return b.connectWith.constructor===String?[b.connectWith]:b.connectWith},_getItemsAsjQuery:function(b){var d,c,k,f,g=[],e=[],h=this._connectWith();if(h&&b){for(d=h.length-1;d>=0;d--){k=a(h[d],this.document[0]);for(c=k.length-1;c>=0;c--){f=a.data(k[c],this.widgetFullName);if(f&&f!==this&&!f.options.disabled){e.push([a.isFunction(f.options.items)?f.options.items.call(f.element):a(f.options.items,f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),f])}}}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);function l(){g.push(this)}for(d=e.length-1;d>=0;d--){e[d][0].each(l)}return a(g)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,function(d){for(var c=0;c<b.length;c++){if(b[c]===d.item[0]){return false}}return true})},_refreshItems:function(b){this.items=[];this.containers=[this];var f,d,m,g,l,c,o,n,h=this.items,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],k=this._connectWith();if(k&&this.ready){for(f=k.length-1;f>=0;f--){m=a(k[f],this.document[0]);for(d=m.length-1;d>=0;d--){g=a.data(m[d],this.widgetFullName);if(g&&g!==this&&!g.options.disabled){e.push([a.isFunction(g.options.items)?g.options.items.call(g.element[0],b,{item:this.currentItem}):a(g.options.items,g.element),g]);this.containers.push(g)}}}}for(f=e.length-1;f>=0;f--){l=e[f][1];c=e[f][0];for(d=0,n=c.length;d<n;d++){o=a(c[d]);o.data(this.widgetName+"-item",l);h.push({item:o,instance:l,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.floating=this.items.length?this.options.axis==="x"||this._isFloating(this.items[0].item):false;if(this.offsetParent&&this.helper){this.offset.parent=this._getParentOffset()}var d,e,c,f;for(d=this.items.length-1;d>=0;d--){e=this.items[d];if(e.instance!==this.currentContainer&&this.currentContainer&&e.item[0]!==this.currentItem[0]){continue}c=this.options.toleranceElement?a(this.options.toleranceElement,e.item):e.item;if(!b){e.width=c.outerWidth();e.height=c.outerHeight()}f=c.offset();e.left=f.left;e.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers){this.options.custom.refreshContainers.call(this)}else{for(d=this.containers.length-1;d>=0;d--){f=this.containers[d].element.offset();this.containers[d].containerCache.left=f.left;this.containers[d].containerCache.top=f.top;this.containers[d].containerCache.width=this.containers[d].element.outerWidth();this.containers[d].containerCache.height=this.containers[d].element.outerHeight()}}return this},_createPlaceholder:function(c){c=c||this;var b,d=c.options;if(!d.placeholder||d.placeholder.constructor===String){b=d.placeholder;d.placeholder={element:function(){var f=c.currentItem[0].nodeName.toLowerCase(),e=a("<"+f+">",c.document[0]);c._addClass(e,"ui-sortable-placeholder",b||c.currentItem[0].className)._removeClass(e,"ui-sortable-helper");if(f==="tbody"){c._createTrPlaceholder(c.currentItem.find("tr").eq(0),a("<tr>",c.document[0]).appendTo(e))}else{if(f==="tr"){c._createTrPlaceholder(c.currentItem,e)}else{if(f==="img"){e.attr("src",c.currentItem.attr("src"))}}}if(!b){e.css("visibility","hidden")}return e},update:function(e,f){if(b&&!d.forcePlaceholderSize){return}if(!f.height()){f.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10))}if(!f.width()){f.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem));c.currentItem.after(c.placeholder);d.placeholder.update(c,c.placeholder)},_createTrPlaceholder:function(c,b){var d=this;c.children().each(function(){a("<td>&#160;</td>",d.document[0]).attr("colspan",a(this).attr("colspan")||1).appendTo(b)})},_contactContainers:function(b){var g,e,m,h,k,o,p,f,l,d,c=null,n=null;for(g=this.containers.length-1;g>=0;g--){if(a.contains(this.currentItem[0],this.containers[g].element[0])){continue}if(this._intersectsWith(this.containers[g].containerCache)){if(c&&a.contains(this.containers[g].element[0],c.element[0])){continue}c=this.containers[g];n=g}else{if(this.containers[g].containerCache.over){this.containers[g]._trigger("out",b,this._uiHash(this));this.containers[g].containerCache.over=0}}}if(!c){return}if(this.containers.length===1){if(!this.containers[n].containerCache.over){this.containers[n]._trigger("over",b,this._uiHash(this));this.containers[n].containerCache.over=1}}else{m=10000;h=null;l=c.floating||this._isFloating(this.currentItem);k=l?"left":"top";o=l?"width":"height";d=l?"pageX":"pageY";for(e=this.items.length-1;e>=0;e--){if(!a.contains(this.containers[n].element[0],this.items[e].item[0])){continue}if(this.items[e].item[0]===this.currentItem[0]){continue}p=this.items[e].item.offset()[k];f=false;if(b[d]-p>this.items[e][o]/2){f=true}if(Math.abs(b[d]-p)<m){m=Math.abs(b[d]-p);h=this.items[e];this.direction=f?"up":"down"}}if(!h&&!this.options.dropOnEmpty){return}if(this.currentContainer===this.containers[n]){if(!this.currentContainer.containerCache.over){this.containers[n]._trigger("over",b,this._uiHash());this.currentContainer.containerCache.over=1}return}h?this._rearrange(b,h,null,true):this._rearrange(b,null,this.containers[n].element,true);this._trigger("change",b,this._uiHash());this.containers[n]._trigger("change",b,this._uiHash(this));this.currentContainer=this.containers[n];this.options.placeholder.update(this.currentContainer,this.placeholder);this.containers[n]._trigger("over",b,this._uiHash(this));this.containers[n].containerCache.over=1}},_createHelper:function(c){var d=this.options,b=a.isFunction(d.helper)?a(d.helper.apply(this.element[0],[c,this.currentItem])):(d.helper==="clone"?this.currentItem.clone():this.currentItem);if(!b.parents("body").length){a(d.appendTo!=="parent"?d.appendTo:this.currentItem[0].parentNode)[0].appendChild(b[0])}if(b[0]===this.currentItem[0]){this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}}if(!b[0].style.width||d.forceHelperSize){b.width(this.currentItem.width())}if(!b[0].style.height||d.forceHelperSize){b.height(this.currentItem.height())}return b},_adjustOffsetFromHelper:function(b){if(typeof b==="string"){b=b.split(" ")}if(a.isArray(b)){b={left:+b[0],top:+b[1]||0}}if("left" in b){this.offset.click.left=b.left+this.margins.left}if("right" in b){this.offset.click.left=this.helperProportions.width-b.right+this.margins.left}if("top" in b){this.offset.click.top=b.top+this.margins.top}if("bottom" in b){this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top}},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();if(this.cssPosition==="absolute"&&this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0])){b.left+=this.scrollParent.scrollLeft();b.top+=this.scrollParent.scrollTop()}if(this.offsetParent[0]===this.document[0].body||(this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&a.ui.ie)){b={top:0,left:0}}return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var b=this.currentItem.position();return{top:b.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:b.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}else{return{top:0,left:0}}},_cacheMargins:function(){this.margins={left:(parseInt(this.currentItem.css("marginLeft"),10)||0),top:(parseInt(this.currentItem.css("marginTop"),10)||0)}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var c,e,b,d=this.options;if(d.containment==="parent"){d.containment=this.helper[0].parentNode}if(d.containment==="document"||d.containment==="window"){this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,d.containment==="document"?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(d.containment==="document"?(this.document.height()||document.body.parentNode.scrollHeight):this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]}if(!(/^(document|window|parent)$/).test(d.containment)){c=a(d.containment)[0];e=a(d.containment).offset();b=(a(c).css("overflow")!=="hidden");this.containment=[e.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,e.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,e.left+(b?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,e.top+(b?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,g){if(!g){g=this.position}var c=e==="absolute"?1:-1,b=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,f=(/(html|body)/i).test(b[0].tagName);return{top:(g.top+this.offset.relative.top*c+this.offset.parent.top*c-((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(f?0:b.scrollTop()))*c)),left:(g.left+this.offset.relative.left*c+this.offset.parent.left*c-((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():f?0:b.scrollLeft())*c))}},_generatePosition:function(e){var g,f,h=this.options,d=e.pageX,c=e.pageY,b=this.cssPosition==="absolute"&&!(this.scrollParent[0]!==this.document[0]&&a.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,i=(/(html|body)/i).test(b[0].tagName);if(this.cssPosition==="relative"&&!(this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0])){this.offset.relative=this._getRelativeOffset()}if(this.originalPosition){if(this.containment){if(e.pageX-this.offset.click.left<this.containment[0]){d=this.containment[0]+this.offset.click.left}if(e.pageY-this.offset.click.top<this.containment[1]){c=this.containment[1]+this.offset.click.top}if(e.pageX-this.offset.click.left>this.containment[2]){d=this.containment[2]+this.offset.click.left}if(e.pageY-this.offset.click.top>this.containment[3]){c=this.containment[3]+this.offset.click.top}}if(h.grid){g=this.originalPageY+Math.round((c-this.originalPageY)/h.grid[1])*h.grid[1];c=this.containment?((g-this.offset.click.top>=this.containment[1]&&g-this.offset.click.top<=this.containment[3])?g:((g-this.offset.click.top>=this.containment[1])?g-h.grid[1]:g+h.grid[1])):g;f=this.originalPageX+Math.round((d-this.originalPageX)/h.grid[0])*h.grid[0];d=this.containment?((f-this.offset.click.left>=this.containment[0]&&f-this.offset.click.left<=this.containment[2])?f:((f-this.offset.click.left>=this.containment[0])?f-h.grid[0]:f+h.grid[0])):f}}return{top:(c-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+((this.cssPosition==="fixed"?-this.scrollParent.scrollTop():(i?0:b.scrollTop())))),left:(d-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+((this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():i?0:b.scrollLeft())))}},_rearrange:function(f,e,c,d){c?c[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],(this.direction==="down"?e.item[0]:e.item[0].nextSibling));this.counter=this.counter?++this.counter:1;var b=this.counter;this._delay(function(){if(b===this.counter){this.refreshPositions(!d)}})},_clear:function(c,e){this.reverting=false;var b,f=[];if(!this._noFinalSort&&this.currentItem.parent().length){this.placeholder.before(this.currentItem)}this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(b in this._storedCSS){if(this._storedCSS[b]==="auto"||this._storedCSS[b]==="static"){this._storedCSS[b]=""}}this.currentItem.css(this._storedCSS);this._removeClass(this.currentItem,"ui-sortable-helper")}else{this.currentItem.show()}if(this.fromOutside&&!e){f.push(function(g){this._trigger("receive",g,this._uiHash(this.fromOutside))})}if((this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!==this.currentItem.parent()[0])&&!e){f.push(function(g){this._trigger("update",g,this._uiHash())})}if(this!==this.currentContainer){if(!e){f.push(function(g){this._trigger("remove",g,this._uiHash())});f.push((function(g){return function(h){g._trigger("receive",h,this._uiHash(this))}}).call(this,this.currentContainer));f.push((function(g){return function(h){g._trigger("update",h,this._uiHash(this))}}).call(this,this.currentContainer))}}function d(i,g,h){return function(j){h._trigger(i,j,g._uiHash(g))}}for(b=this.containers.length-1;b>=0;b--){if(!e){f.push(d("deactivate",this,this.containers[b]))}if(this.containers[b].containerCache.over){f.push(d("out",this,this.containers[b]));this.containers[b].containerCache.over=0}}if(this.storedCursor){this.document.find("body").css("cursor",this.storedCursor);this.storedStylesheet.remove()}if(this._storedOpacity){this.helper.css("opacity",this._storedOpacity)}if(this._storedZIndex){this.helper.css("zIndex",this._storedZIndex==="auto"?"":this._storedZIndex)}this.dragging=false;if(!e){this._trigger("beforeStop",c,this._uiHash())}this.placeholder[0].parentNode.removeChild(this.placeholder[0]);if(!this.cancelHelperRemoval){if(this.helper[0]!==this.currentItem[0]){this.helper.remove()}this.helper=null}if(!e){for(b=0;b<f.length;b++){f[b].call(this,c)}this._trigger("stop",c,this._uiHash())}this.fromOutside=false;return !this.cancelHelperRemoval},_trigger:function(){if(a.Widget.prototype._trigger.apply(this,arguments)===false){this.cancel()}},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}})}));