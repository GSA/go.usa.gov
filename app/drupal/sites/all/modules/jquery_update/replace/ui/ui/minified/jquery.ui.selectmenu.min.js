/*!
 * jQuery UI Selectmenu @VERSION
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery","./menu","../escape-selector","../form-reset-mixin","../keycode","../labels","../position","../unique-id","../version","../widget"],a)}else{a(jQuery)}}(function(a){return a.widget("ui.selectmenu",[a.ui.formResetMixin,{version:"@VERSION",defaultElement:"<select>",options:{appendTo:null,classes:{"ui-selectmenu-button-open":"ui-corner-top","ui-selectmenu-button-closed":"ui-corner-all"},disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:false,change:null,close:null,focus:null,open:null,select:null},_create:function(){var b=this.element.uniqueId().attr("id");this.ids={element:b,button:b+"-button",menu:b+"-menu"};this._drawButton();this._drawMenu();this._bindFormResetHandler();this._rendered=false;this.menuItems=a()},_drawButton:function(){var b,d=this,c=this._parseOption(this.element.find("option:selected"),this.element[0].selectedIndex);this.labels=this.element.labels().attr("for",this.ids.button);this._on(this.labels,{click:function(e){this.button.focus();e.preventDefault()}});this.element.hide();this.button=a("<span>",{tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true",title:this.element.attr("title")}).insertAfter(this.element);this._addClass(this.button,"ui-selectmenu-button ui-selectmenu-button-closed","ui-button ui-widget");b=a("<span>").appendTo(this.button);this._addClass(b,"ui-selectmenu-icon","ui-icon "+this.options.icons.button);this.buttonItem=this._renderButtonItem(c).appendTo(this.button);if(this.options.width!==false){this._resizeButton()}this._on(this.button,this._buttonEvents);this.button.one("focusin",function(){if(!d._rendered){d._refreshMenu()}})},_drawMenu:function(){var b=this;this.menu=a("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu});this.menuWrap=a("<div>").append(this.menu);this._addClass(this.menuWrap,"ui-selectmenu-menu","ui-front");this.menuWrap.appendTo(this._appendTo());this.menuInstance=this.menu.menu({classes:{"ui-menu":"ui-corner-bottom"},role:"listbox",select:function(c,d){c.preventDefault();b._setSelection();b._select(d.item.data("ui-selectmenu-item"),c)},focus:function(d,e){var c=e.item.data("ui-selectmenu-item");if(b.focusIndex!=null&&c.index!==b.focusIndex){b._trigger("focus",d,{item:c});if(!b.isOpen){b._select(c,d)}}b.focusIndex=c.index;b.button.attr("aria-activedescendant",b.menuItems.eq(c.index).attr("id"))}}).menu("instance");this.menuInstance._off(this.menu,"mouseleave");this.menuInstance._closeOnDocumentClick=function(){return false};this.menuInstance._isDivider=function(){return false}},refresh:function(){this._refreshMenu();this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(this._getSelectedItem().data("ui-selectmenu-item")||{}));if(this.options.width===null){this._resizeButton()}},_refreshMenu:function(){var c,b=this.element.find("option");this.menu.empty();this._parseOptions(b);this._renderMenu(this.menu,this.items);this.menuInstance.refresh();this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup").find(".ui-menu-item-wrapper");this._rendered=true;if(!b.length){return}c=this._getSelectedItem();this.menuInstance.focus(null,c);this._setAria(c.data("ui-selectmenu-item"));this._setOption("disabled",this.element.prop("disabled"))},open:function(b){if(this.options.disabled){return}if(!this._rendered){this._refreshMenu()}else{this._removeClass(this.menu.find(".ui-state-active"),null,"ui-state-active");this.menuInstance.focus(null,this._getSelectedItem())}if(!this.menuItems.length){return}this.isOpen=true;this._toggleAttr();this._resizeMenu();this._position();this._on(this.document,this._documentClick);this._trigger("open",b)},_position:function(){this.menuWrap.position(a.extend({of:this.button},this.options.position))},close:function(b){if(!this.isOpen){return}this.isOpen=false;this._toggleAttr();this.range=null;this._off(this.document);this._trigger("close",b)},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderButtonItem:function(c){var b=a("<span>");this._setText(b,c.label);this._addClass(b,"ui-selectmenu-text");return b},_renderMenu:function(d,c){var e=this,b="";a.each(c,function(g,h){var f;if(h.optgroup!==b){f=a("<li>",{text:h.optgroup});e._addClass(f,"ui-selectmenu-optgroup","ui-menu-divider"+(h.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""));f.appendTo(d);b=h.optgroup}e._renderItemData(d,h)})},_renderItemData:function(b,c){return this._renderItem(b,c).data("ui-selectmenu-item",c)},_renderItem:function(c,d){var b=a("<li>"),e=a("<div>",{title:d.element.attr("title")});if(d.disabled){this._addClass(b,null,"ui-state-disabled")}this._setText(e,d.label);return b.append(e).appendTo(c)},_setText:function(b,c){if(c){b.text(c)}else{b.html("&#160;")}},_move:function(f,e){var d,c,b=".ui-menu-item";if(this.isOpen){d=this.menuItems.eq(this.focusIndex).parent("li")}else{d=this.menuItems.eq(this.element[0].selectedIndex).parent("li");b+=":not(.ui-state-disabled)"}if(f==="first"||f==="last"){c=d[f==="first"?"prevAll":"nextAll"](b).eq(-1)}else{c=d[f+"All"](b).eq(0)}if(c.length){this.menuInstance.focus(e,c)}},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex).parent("li")},_toggle:function(b){this[this.isOpen?"close":"open"](b)},_setSelection:function(){var b;if(!this.range){return}if(window.getSelection){b=window.getSelection();b.removeAllRanges();b.addRange(this.range)}else{this.range.select()}this.button.focus()},_documentClick:{mousedown:function(b){if(!this.isOpen){return}if(!a(b.target).closest(".ui-selectmenu-menu, #"+a.ui.escapeSelector(this.ids.button)).length){this.close(b)}}},_buttonEvents:{mousedown:function(){var b;if(window.getSelection){b=window.getSelection();if(b.rangeCount){this.range=b.getRangeAt(0)}}else{this.range=document.selection.createRange()}},click:function(b){this._setSelection();this._toggle(b)},keydown:function(c){var b=true;switch(c.keyCode){case a.ui.keyCode.TAB:case a.ui.keyCode.ESCAPE:this.close(c);b=false;break;case a.ui.keyCode.ENTER:if(this.isOpen){this._selectFocusedItem(c)}break;case a.ui.keyCode.UP:if(c.altKey){this._toggle(c)}else{this._move("prev",c)}break;case a.ui.keyCode.DOWN:if(c.altKey){this._toggle(c)}else{this._move("next",c)}break;case a.ui.keyCode.SPACE:if(this.isOpen){this._selectFocusedItem(c)}else{this._toggle(c)}break;case a.ui.keyCode.LEFT:this._move("prev",c);break;case a.ui.keyCode.RIGHT:this._move("next",c);break;case a.ui.keyCode.HOME:case a.ui.keyCode.PAGE_UP:this._move("first",c);break;case a.ui.keyCode.END:case a.ui.keyCode.PAGE_DOWN:this._move("last",c);break;default:this.menu.trigger(c);b=false}if(b){c.preventDefault()}}},_selectFocusedItem:function(c){var b=this.menuItems.eq(this.focusIndex).parent("li");if(!b.hasClass("ui-state-disabled")){this._select(b.data("ui-selectmenu-item"),c)}},_select:function(c,b){var d=this.element[0].selectedIndex;this.element[0].selectedIndex=c.index;this.buttonItem.replaceWith(this.buttonItem=this._renderButtonItem(c));this._setAria(c);this._trigger("select",b,{item:c});if(c.index!==d){this._trigger("change",b,{item:c})}this.close(b)},_setAria:function(b){var c=this.menuItems.eq(b.index).attr("id");this.button.attr({"aria-labelledby":c,"aria-activedescendant":c});this.menu.attr("aria-activedescendant",c)},_setOption:function(b,d){if(b==="icons"){var c=this.button.find("span.ui-icon");this._removeClass(c,null,this.options.icons.button)._addClass(c,null,d.button)}this._super(b,d);if(b==="appendTo"){this.menuWrap.appendTo(this._appendTo())}if(b==="width"){this._resizeButton()}},_setOptionDisabled:function(b){this._super(b);this.menuInstance.option("disabled",b);this.button.attr("aria-disabled",b);this._toggleClass(this.button,null,"ui-state-disabled",b);this.element.prop("disabled",b);if(b){this.button.attr("tabindex",-1);this.close()}else{this.button.attr("tabindex",0)}},_appendTo:function(){var b=this.options.appendTo;if(b){b=b.jquery||b.nodeType?a(b):this.document.find(b).eq(0)}if(!b||!b[0]){b=this.element.closest(".ui-front, dialog")}if(!b.length){b=this.document[0].body}return b},_toggleAttr:function(){this.button.attr("aria-expanded",this.isOpen);this._removeClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"closed":"open"))._addClass(this.button,"ui-selectmenu-button-"+(this.isOpen?"open":"closed"))._toggleClass(this.menuWrap,"ui-selectmenu-open",null,this.isOpen);this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var b=this.options.width;if(b===false){this.button.css("width","");return}if(b===null){b=this.element.show().outerWidth();this.element.hide()}this.button.outerWidth(b)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){var b=this._super();b.disabled=this.element.prop("disabled");return b},_parseOptions:function(b){var c=this,d=[];b.each(function(e,f){d.push(c._parseOption(a(f),e))});this.items=d},_parseOption:function(d,c){var b=d.parent("optgroup");return{element:d,index:c,value:d.val(),label:d.text(),optgroup:b.attr("label")||"",disabled:b.prop("disabled")||d.prop("disabled")}},_destroy:function(){this._unbindFormResetHandler();this.menuWrap.remove();this.button.remove();this.element.show();this.element.removeUniqueId();this.labels.attr("for",this.ids.element)}}])}));